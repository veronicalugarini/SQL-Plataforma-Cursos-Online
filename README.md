# SQL-Plataforma-Cursos-Online


Projeto de Banco de Dados Relacional (SQL) com utilização do SQL Server, SGBD da Microsoft. Criação de um sistema relacional para E-commerce com foco em serviços educacionais, como cursos rápidos (modalidades online / presencial) e bootcamps. A aplicação permite o cadastramento dos clientes, fornecedores e o controle dos serviços adquiridos. Além de conter as informações necessárias para a emissão de nota de pedido relacionando a todos os serviços e forma de pagamento.

Para este sistema, desenvolvi o modelo de dados conceitual, lógico relacional e por fim, físico. Abaixo, todas as Querys necessárias para a construção do proejto, com criação de tabelas, sua população com dados e comandos projeção de dados para extração de relatórios.

**Modelo Físico**

**1.** Criando o Banco de Dados

```
CREATE DATABASE BDecommerce;
GO
```

**2.** Criação das Tabelas e respectivas colunas

```
CREATE TABLE PEDIDO (
			NUM_PEDIDO INT NOT NULL,
			COD_CLIENTE INT NOT NULL,
			DAT_PEDIDO DATETIME NOT NULL,
			VLR_TOTAL_PEDIDO NUMERIC (10,2),
			COD_FORMA_PAGAMENTO INT NOT NULL);

CREATE TABLE ITEM_PEDIDO (
			NUM_PEDIDO INT NOT NULL,
			COD_ITEM_PEDIDO INT NOT NULL,
			COD_SERVICO INT NOT NULL,
			QTD_SERVICO NUMERIC (2) NOT NULL,
			VLR_TOTAL_ITEM NUMERIC (10,2) NOT NULL);

CREATE TABLE SERVICO (
			COD_SERVICO INT NOT NULL,
			COD_FORNECEDOR INT NOT NULL,
			DSC_SERVICO VARCHAR (500) NOT NULL,
			TIP_SERVICO VARCHAR (50) NOT NULL,
			VLR_SERVCO NUMERIC (10,2) NOT NULL);

CREATE TABLE FORNECEDOR (
			COD_FORNECEDOR INT NOT NULL,
			NOM_FORNECEDOR VARCHAR (100) NOT NULL,
			NUM_CNPJ NUMERIC (15) NULL,
			DSC_ENDERECO VARCHAR (100) NOT NULL,
			NUM_TELEFONE NUMERIC (14) NOT NULL);

CREATE TABLE FORMA_PAGAMENTO (
			COD_FORMA_PAGAMENTO INT NOT NULL,
			DSC_FORMA_PAGAMENTO VARCHAR (100) NOT NULL);

CREATE TABLE CLIENTE (
			COD_CLIENTE INT NOT NULL,
			NOM_CLIENTE VARCHAR (100) NOT NULL,
			NUM_CPF_CNPJ NUMERIC (15) NULL,
			DSC_ENDERECO_COBRANCA VARCHAR (1000) NOT NULL,
			NUM_TELEFONE NUMERIC(14) NOT NULL);
```

**3.** Inserindo Primary Keys
```
ALTER TABLE PEDIDO ADD CONSTRAINT PK_PEDIDO
PRIMARY KEY CLUSTERED (NUM_PEDIDO);

ALTER TABLE ITEM_PEDIDO ADD CONSTRAINT PK_ITEM_PEDIDO
PRIMARY KEY CLUSTERED (COD_ITEM_PEDIDO);

ALTER TABLE SERVICO ADD CONSTRAINT PK_SERVICO
PRIMARY KEY CLUSTERED (COD_SERVICO);

ALTER TABLE FORMA_PAGAMENTO ADD CONSTRAINT PK_FORMA_PAGAMENTO
PRIMARY KEY CLUSTERED (COD_FORMA_PAGAMENTO);

ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE
PRIMARY KEY CLUSTERED (COD_CLIENTE);

ALTER TABLE FORNECEDOR ADD CONSTRAINT PK_FORNECEDOR
PRIMARY KEY CLUSTERED (COD_FORNECEDOR);
```

**4.** Foreign Keys
```
ALTER TABLE PEDIDO ADD CONSTRAINT FK_CLIENTE_PEDIDO
FOREIGN KEY (COD_CLIENTE) REFERENCES CLIENTE(COD_CLIENTE);

ALTER TABLE PEDIDO ADD CONSTRAINT FK_FORMA_PAGAMENTO_PEDIDO
FOREIGN KEY (COD_FORMA_PAGAMENTO) REFERENCES FORMA_PAGAMENTO(COD_FORMA_PAGAMENTO);

ALTER TABLE ITEM_PEDIDO ADD CONSTRAINT FK_PEDIDO_ITEM_PEDIDO
FOREIGN KEY (NUM_PEDIDO) REFERENCES PEDIDO(NUM_PEDIDO);

ALTER TABLE ITEM_PEDIDO ADD CONSTRAINT FK_SERVICO_ITEM_PEDIDO
FOREIGN KEY (COD_SERVICO) REFERENCES SERVICO(COD_SERVICO);

ALTER TABLE SERVICO ADD CONSTRAINT FK_FORNECEDOR_SERVICO
FOREIGN KEY (COD_FORNECEDOR) REFERENCES FORNECEDOR(COD_FORNECEDOR);
```

**5.** Verificando a estrutura das tabelas
```
SP_HELP 'PEDIDO';
SP_HELP 'CLIENTE';
```

**6.** Populando tabelas com dados fictícios
```
INSERT INTO FORNECEDOR (COD_FORNECEDOR,NOM_FORNECEDOR,NUM_CNPJ,DSC_ENDERECO,NUM_TELEFONE)

VALUES 		
		(1,'MATHEUS CARDOSO',00385526816000156,'AVENIDA BRASIL',36589965),
		(2,'LIVTEC',854693147523,'RUA SAO JOSE',963215847),
		(3,'TECNOCOURSE',25478521369548,'AVENIDA PAULISTA',56892156),
		(4,'LUANA SILVA',89547563215698,'RUA SILVA GALVAO',35218574),
		(5,'SHOPLINE',45216985321254,'RUA VENTURA',9685253645),
		(6,'CURSOSONLINE',584596321546963,'AVENIDA DA VARZEA',328547845);


INSERT INTO CLIENTE (COD_CLIENTE,NOM_CLIENTE,NUM_CPF_CNPJ,DSC_ENDERECO_COBRANCA,NUM_TELEFONE)

VALUES 		
		(11,'PAULA SILVEIRA',25685412365,'AVENIDA SAO JOAO',963254178),
		(12,'GUILHERME ALMEIDA',40215698752,'AVENIDA BRAS CUBAS',958451232),
		(13,'LARA REZENDE',45625321458,'RUA JOANA GALVEZ',785412563),
		(14,'PEDRO FIRENZE',56235674152,'RUA NAPOLI',42565412336),
		(15,'CLARA F',85412563974,'ALAMEDA SANTOS',945125487),
		(16,'SARA PORTO',56485721365,'RUA VENANCIO',85456596),
		(17,'HENRIQUE SILVA',65489745632,'RUA PAULA SOUZA',52416325),
		(18,'JOSE ANTONIO',65489745687,'RUA ALTAMIRA',52416387),
		(19,'ANA PAULA',96521452863,'RUA JOAQUIM TAVORA',36528965),
		(20,'CARLA SILVA',42589636254,'ALAMEDA CAMPINAS',985254152);


INSERT INTO FORMA_PAGAMENTO (COD_FORMA_PAGAMENTO, DSC_FORMA_PAGAMENTO)
VALUES 			
			(1,'CREDITO'),
			(2,'DEBITO');

INSERT INTO PEDIDO (NUM_PEDIDO, COD_CLIENTE, DAT_PEDIDO, VLR_TOTAL_PEDIDO, COD_FORMA_PAGAMENTO)
VALUES 	
		(100,11,2020-02-15,100.00,1),
		(101,12,2020-08-01,250.00,1),
		(102,13,2019-02-08,300.00,2),
		(103,14,2019-10-25,100.00,1),
		(104,15,2020-05-22,200.00,1),
		(105,16,2020-03-05,400.00,2),
		(106,17,2020-04-30,100.00,1),
		(107,11,2020-01-15,150.00,2),
		(108,11,2019-07-06,400.00,1),
		(109,16,2020-04-23,150.00,1);

INSERT INTO SERVICO (COD_SERVICO, COD_FORNECEDOR, DSC_SERVICO,TIP_SERVICO, VLR_SERVCO)
VALUES 			
			(1,5,'CURSO SQL COMPLETO', 'EAD', 100.00),
			(2,1,'POWER BI','EAD',250.00),
			(3,6,'MONGODB','EAD',200.00),
			(4,2,'DATA SCIENCE','PRESENCIAL',300.00),
			(5,3,'CASSANDRA','EAD',150.00),
			(6,4,'TABLEAU','EAD',400.00),
			(7,5,'BIG DATA','EAD',100.00);

INSERT INTO ITEM_PEDIDO (NUM_PEDIDO,COD_ITEM_PEDIDO, COD_SERVICO, QTD_SERVICO,VLR_TOTAL_ITEM)
VALUES 		
		(100,500,1,2,200.00),
		(101,501,2,1,250.00),
		(102,502,4,2,600.00),
		(103,503,5,1,150.00),
		(104,504,6,2,800.00),
		(105,505,7,1,100.00),
		(106,506,4,1,300.00),
		(107,507,2,2,500.00),
		(108,508,7,1,100.00),
		(109,509,1,1,100.00);
```

**7.** Confirmando se os dados foram inseridos corretamente
```
SELECT * FROM FORNECEDOR;
SELECT * FROM CLIENTE;
SELECT * FROM FORMA_PAGAMENTO;
SELECT * FROM PEDIDO;
SELECT * FROM SERVICO;
SELECT * FROM ITEM_PEDIDO;
```
**8.** Query para Lista única de contatos de clientes e fornecedores, ordenando alfabeticamente pela coluna Nome
```
SELECT C.NOM_CLIENTE AS NOME, C.DSC_ENDERECO_COBRANCA AS ENDERECO, C.NUM_TELEFONE AS TELEFONE 
FROM CLIENTE C
UNION
SELECT F.NOM_FORNECEDOR AS NOME, F.DSC_ENDERECO AS ENDERECO, F.NUM_TELEFONE AS TELEFONE
FROM FORNECEDOR F
ORDER BY NOME;
```
**9.** Relatório com Lista de clintes que não fizeram pedido
```
SELECT NOM_CLIENTE AS NOME, NUM_TELEFONE AS TELEFONE
FROM CLIENTE
WHERE COD_CLIENTE NOT IN(SELECT COD_CLIENTE FROM PEDIDO)
ORDER BY NOM_CLIENTE;
```
**9.** Retorno do relatório
```
NOME	        TELEFONE
ANA PAULA	36528965
CARLA SILVA	985254152
JOSE ANTONIO	52416387
```

**10.** Alterando os valores que estão como R$ 100.00 na tabela pedido para R$ 0.00 (para depois, fazer a correção pela query do item 11)
```
UPDATE PEDIDO 
SET VLR_TOTAL_PEDIDO = 0.00
WHERE VLR_TOTAL_PEDIDO = 100.00;
```
(3 linha(s) afetadas)
```
SELECT NUM_PEDIDO AS 'ID PEDIDO', COD_CLIENTE AS 'ID CLIENTE', VLR_TOTAL_PEDIDO AS 'VALOR TOTAL', COD_FORMA_PAGAMENTO AS 'FORMA DE PAGAMENTO' FROM PEDIDO;
```
Tabela alterada: 

![ALTER_VALOR](https://user-images.githubusercontent.com/64870434/89713506-79b8b700-d96e-11ea-8fd0-2773a1589437.png)

**10.** Atualização da coluna VLR_TOTAL_PEDIDO nos casos em que está nula ou com valor total calculado erroneamente
```
UPDATE PEDIDO
SET VLR_TOTAL_PEDIDO = P1.VLR_TOTAL_ITENS
FROM PEDIDO P
JOIN (SELECT P.NUM_PEDIDO, P.VLR_TOTAL_PEDIDO, SUM(I.VLR_TOTAL_ITEM) as VLR_TOTAL_ITENS
FROM PEDIDO P JOIN ITEM_PEDIDO I
ON P.NUM_PEDIDO = I.NUM_PEDIDO
GROUP BY P.NUM_PEDIDO, P.VLR_TOTAL_PEDIDO
HAVING P.VLR_TOTAL_PEDIDO != SUM(I.VLR_TOTAL_ITEM) OR P.VLR_TOTAL_PEDIDO IS NULL) P1
ON P.NUM_PEDIDO = P1.NUM_PEDIDO;
```
**10.** Resultado da Query

![VALOR_ALTERADO](https://user-images.githubusercontent.com/64870434/89713622-4165a880-d96f-11ea-91ee-680ef31dfdf2.png)

**11.** Clientes SEM CPF cadastrado

**11.1** Atualizando CPF para NULL, dos clientes com ID/código maior ou igual a 18
```
UPDATE CLIENTE
SET NUM_CPF_CNPJ = NULL
WHERE COD_CLIENTE >= 18;

SELECT COD_CLIENTE AS 'ID CLIENTE', NOM_CLIENTE AS 'NOME', NUM_CPF_CNPJ AS 'CPF' FROM CLIENTE;
```
**11.2** Verificando alteração

![cpf_null](https://user-images.githubusercontent.com/64870434/89713426-fa2ae800-d96d-11ea-90e0-411eb0c2bd6c.png)

**11.3** Relatório de clientes SEM CPF no Banco
```
SELECT CAST(COUNT (COALESCE (NUM_CPF_CNPJ,0)) AS numeric) AS 'CLIENTES SEM CPF'
FROM CLIENTE 
WHERE NUM_CPF_CNPJ IS NULL;
```

![clientes_sem_cpf](https://user-images.githubusercontent.com/64870434/89713653-8d185200-d96f-11ea-93b3-d30f6b072805.png)
